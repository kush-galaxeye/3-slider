{"ast":null,"code":"import { normSpaces, hasOpenreplayAttribute, getLabelAttribute } from \"../utils.js\";\nimport { MouseMove, MouseClick } from \"../messages/index.js\";\nimport { getInputLabel } from \"./input.js\";\n\nfunction _getSelector(target) {\n  let el = target;\n  let selector = null;\n\n  do {\n    if (el.id) {\n      return `#${el.id}` + (selector ? ` > ${selector}` : '');\n    }\n\n    selector = el.className.split(' ').map(cn => cn.trim()).filter(cn => cn !== '').reduce((sel, cn) => `${sel}.${cn}`, el.tagName.toLowerCase()) + (selector ? ` > ${selector}` : '');\n\n    if (el === document.body) {\n      return selector;\n    }\n\n    el = el.parentElement;\n  } while (el !== document.body && el !== null);\n\n  return selector;\n} //TODO: fix (typescript doesn't allow work when the guard is inside the function)\n\n\nfunction getTarget(target) {\n  if (target instanceof Element) {\n    return _getTarget(target);\n  }\n\n  return null;\n}\n\nfunction _getTarget(target) {\n  let element = target;\n\n  while (element !== null && element !== document.documentElement) {\n    if (hasOpenreplayAttribute(element, 'masked')) {\n      return null;\n    }\n\n    element = element.parentElement;\n  }\n\n  if (target instanceof SVGElement) {\n    let owner = target.ownerSVGElement;\n\n    while (owner !== null) {\n      target = owner;\n      owner = owner.ownerSVGElement;\n    }\n  }\n\n  element = target;\n\n  while (element !== null && element !== document.documentElement) {\n    const tag = element.tagName.toUpperCase();\n\n    if (tag === 'LABEL') {\n      return null;\n    }\n\n    if (tag === 'INPUT') {\n      return element;\n    }\n\n    if (tag === 'BUTTON' || tag === 'A' || tag === 'LI' || element.onclick != null || element.getAttribute('role') === 'button' || getLabelAttribute(element) !== null) {\n      return element;\n    }\n\n    element = element.parentElement;\n  }\n\n  return target === document.documentElement ? null : target;\n}\n\nexport default function (app) {\n  // const options: Options = Object.assign(\n  //   {},\n  //   opts,\n  // );\n  function getTargetLabel(target) {\n    const dl = getLabelAttribute(target);\n\n    if (dl !== null) {\n      return dl;\n    }\n\n    const tag = target.tagName.toUpperCase();\n\n    if (tag === 'INPUT') {\n      return getInputLabel(target);\n    }\n\n    if (tag === 'BUTTON' || tag === 'A' || tag === 'LI' || target.onclick != null || target.getAttribute('role') === 'button') {\n      const label = app.observer.getInnerTextSecure(target);\n      return normSpaces(label).slice(0, 100);\n    }\n\n    return '';\n  }\n\n  let mousePositionX = -1;\n  let mousePositionY = -1;\n  let mousePositionChanged = false;\n  let mouseTarget = null;\n  let mouseTargetTime = 0;\n  app.attachStopCallback(() => {\n    mousePositionX = -1;\n    mousePositionY = -1;\n    mousePositionChanged = false;\n    mouseTarget = null;\n  });\n\n  const sendMouseMove = () => {\n    if (mousePositionChanged) {\n      app.send(new MouseMove(mousePositionX, mousePositionY));\n      mousePositionChanged = false;\n    }\n  };\n\n  const selectorMap = {};\n\n  function getSelector(id, target) {\n    return selectorMap[id] = selectorMap[id] || _getSelector(target);\n  }\n\n  app.attachEventListener(document.documentElement, 'mouseover', e => {\n    const target = getTarget(e.target);\n\n    if (target !== mouseTarget) {\n      mouseTarget = target;\n      mouseTargetTime = performance.now();\n    }\n  });\n  app.attachEventListener(document, 'mousemove', e => {\n    mousePositionX = e.clientX;\n    mousePositionY = e.clientY;\n    mousePositionChanged = true;\n  }, false);\n  app.attachEventListener(document, 'click', e => {\n    const target = getTarget(e.target);\n\n    if (!e.clientX && !e.clientY || target === null) {\n      return;\n    }\n\n    const id = app.nodes.getID(target);\n\n    if (id !== undefined) {\n      sendMouseMove();\n      app.send(new MouseClick(id, mouseTarget === target ? Math.round(performance.now() - mouseTargetTime) : 0, getTargetLabel(target), getSelector(id, target)), true);\n    }\n\n    mouseTarget = null;\n  });\n  app.ticker.attach(sendMouseMove, 10);\n}","map":{"version":3,"sources":["/Users/kushthakker/Downloads/imagecompare-both/node_modules/@openreplay/tracker/lib/modules/mouse.js"],"names":["normSpaces","hasOpenreplayAttribute","getLabelAttribute","MouseMove","MouseClick","getInputLabel","_getSelector","target","el","selector","id","className","split","map","cn","trim","filter","reduce","sel","tagName","toLowerCase","document","body","parentElement","getTarget","Element","_getTarget","element","documentElement","SVGElement","owner","ownerSVGElement","tag","toUpperCase","onclick","getAttribute","app","getTargetLabel","dl","label","observer","getInnerTextSecure","slice","mousePositionX","mousePositionY","mousePositionChanged","mouseTarget","mouseTargetTime","attachStopCallback","sendMouseMove","send","selectorMap","getSelector","attachEventListener","e","performance","now","clientX","clientY","nodes","getID","undefined","Math","round","ticker","attach"],"mappings":"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","sourcesContent":["import { normSpaces, hasOpenreplayAttribute, getLabelAttribute } from \"../utils.js\";\nimport { MouseMove, MouseClick } from \"../messages/index.js\";\nimport { getInputLabel } from \"./input.js\";\nfunction _getSelector(target) {\n    let el = target;\n    let selector = null;\n    do {\n        if (el.id) {\n            return `#${el.id}` + (selector ? ` > ${selector}` : '');\n        }\n        selector =\n            el.className.split(' ')\n                .map(cn => cn.trim())\n                .filter(cn => cn !== '')\n                .reduce((sel, cn) => `${sel}.${cn}`, el.tagName.toLowerCase()) +\n                (selector ? ` > ${selector}` : '');\n        if (el === document.body) {\n            return selector;\n        }\n        el = el.parentElement;\n    } while (el !== document.body && el !== null);\n    return selector;\n}\n//TODO: fix (typescript doesn't allow work when the guard is inside the function)\nfunction getTarget(target) {\n    if (target instanceof Element) {\n        return _getTarget(target);\n    }\n    return null;\n}\nfunction _getTarget(target) {\n    let element = target;\n    while (element !== null && element !== document.documentElement) {\n        if (hasOpenreplayAttribute(element, 'masked')) {\n            return null;\n        }\n        element = element.parentElement;\n    }\n    if (target instanceof SVGElement) {\n        let owner = target.ownerSVGElement;\n        while (owner !== null) {\n            target = owner;\n            owner = owner.ownerSVGElement;\n        }\n    }\n    element = target;\n    while (element !== null && element !== document.documentElement) {\n        const tag = element.tagName.toUpperCase();\n        if (tag === 'LABEL') {\n            return null;\n        }\n        if (tag === 'INPUT') {\n            return element;\n        }\n        if (tag === 'BUTTON' ||\n            tag === 'A' ||\n            tag === 'LI' ||\n            element.onclick != null ||\n            element.getAttribute('role') === 'button' ||\n            getLabelAttribute(element) !== null) {\n            return element;\n        }\n        element = element.parentElement;\n    }\n    return target === document.documentElement ? null : target;\n}\nexport default function (app) {\n    // const options: Options = Object.assign(\n    //   {},\n    //   opts,\n    // );\n    function getTargetLabel(target) {\n        const dl = getLabelAttribute(target);\n        if (dl !== null) {\n            return dl;\n        }\n        const tag = target.tagName.toUpperCase();\n        if (tag === 'INPUT') {\n            return getInputLabel(target);\n        }\n        if (tag === 'BUTTON' ||\n            tag === 'A' ||\n            tag === 'LI' ||\n            target.onclick != null ||\n            target.getAttribute('role') === 'button') {\n            const label = app.observer.getInnerTextSecure(target);\n            return normSpaces(label).slice(0, 100);\n        }\n        return '';\n    }\n    let mousePositionX = -1;\n    let mousePositionY = -1;\n    let mousePositionChanged = false;\n    let mouseTarget = null;\n    let mouseTargetTime = 0;\n    app.attachStopCallback(() => {\n        mousePositionX = -1;\n        mousePositionY = -1;\n        mousePositionChanged = false;\n        mouseTarget = null;\n    });\n    const sendMouseMove = () => {\n        if (mousePositionChanged) {\n            app.send(new MouseMove(mousePositionX, mousePositionY));\n            mousePositionChanged = false;\n        }\n    };\n    const selectorMap = {};\n    function getSelector(id, target) {\n        return selectorMap[id] = selectorMap[id] || _getSelector(target);\n    }\n    app.attachEventListener(document.documentElement, 'mouseover', (e) => {\n        const target = getTarget(e.target);\n        if (target !== mouseTarget) {\n            mouseTarget = target;\n            mouseTargetTime = performance.now();\n        }\n    });\n    app.attachEventListener(document, 'mousemove', (e) => {\n        mousePositionX = e.clientX;\n        mousePositionY = e.clientY;\n        mousePositionChanged = true;\n    }, false);\n    app.attachEventListener(document, 'click', (e) => {\n        const target = getTarget(e.target);\n        if ((!e.clientX && !e.clientY) || target === null) {\n            return;\n        }\n        const id = app.nodes.getID(target);\n        if (id !== undefined) {\n            sendMouseMove();\n            app.send(new MouseClick(id, mouseTarget === target\n                ? Math.round(performance.now() - mouseTargetTime)\n                : 0, getTargetLabel(target), getSelector(id, target)), true);\n        }\n        mouseTarget = null;\n    });\n    app.ticker.attach(sendMouseMove, 10);\n}\n"]},"metadata":{},"sourceType":"module"}